<!DOCTYPE html>
<html lang="nn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lag tilfeldige grupper 游뿏</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --body-bg: #2c2c2c;
            --body-color: #ecf0f1;
            --card-bg: #3b3b3b;
            --input-bg: #272727;
            --border-color: #4a4a4a;
            --primary-color: #3498db;
            --primary-hover-color: #2980b9;
            --secondary-color: #4f4f4f;
            --secondary-hover-color: #5f5f5f;
            --green-color: #27ae60;
            --green-hover-color: #229954;
            --red-color: #c0392b;
            --font-sans: 'Inter', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        /* Grunnleggjande stil */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { font-size: 16px; }
        body {
            font-family: var(--font-sans);
            background-color: var(--body-bg);
            color: var(--body-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1.5rem;
        }

        /* Hovud-container */
        .main-container {
            position: relative;
            width: 100%;
            max-width: 56rem;
            background-color: var(--card-bg);
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        header { text-align: center; margin-bottom: 1.5rem; }
        h1 { font-size: 2.25rem; font-weight: 700; }
        header p { margin-top: 0.5rem; color: #bdc3c7; }

        /* Guide-boks */
        .guide-box {
            margin-bottom: 2rem;
            padding: 1rem;
            background-color: rgba(52, 152, 219, 0.1);
            border: 1px solid var(--primary-color);
            border-radius: 0.5rem;
        }
        .guide-box h2 { font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem; }
        .guide-box ol { list-style-position: inside; list-style-type: decimal; padding-left: 0.5rem; }
        .guide-box li { margin-bottom: 0.25rem; }

        /* Skjemaelement */
        label { display: block; font-weight: 500; margin-bottom: 0.5rem; }
        textarea {
            width: 100%;
            padding: 0.75rem;
            background-color: var(--input-bg);
            color: var(--body-color);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            font-family: var(--font-sans);
            resize: vertical;
            min-height: 150px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.3);
        }

        /* Knappar */
        .button-group { display: flex; gap: 1rem; margin-top: 1rem; }
        button {
            font-family: var(--font-sans);
            font-weight: 700;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }
        button:active { transform: scale(0.98); }

        .btn-primary { flex-grow: 1; background-color: var(--primary-color); color: white; }
        .btn-primary:hover { background-color: var(--primary-hover-color); }
        .btn-secondary { flex-grow: 1; background-color: var(--secondary-color); color: var(--body-color); }
        .btn-secondary:hover { background-color: var(--secondary-hover-color); }

        #restart-button {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background-color: transparent;
            color: #95a5a6;
            padding: 0.5rem;
            border-radius: 50%;
        }
        #restart-button:hover { background-color: var(--secondary-color); color: var(--body-color); }

        #generate-groups-button { background-color: var(--green-color); color: white; width: 100%; }
        #generate-groups-button:hover { background-color: var(--green-hover-color); }

        /* Seksjonar for steg 2 */
        .step2-section { margin-top: 2rem; }
        .step2-section h2 { font-size: 1.25rem; font-weight: 600; margin-bottom: 0.75rem; }

        #student-selection-list {
            max-height: 200px;
            overflow-y: auto;
            padding: 0.75rem;
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 0.5rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            border-radius: 0.25rem;
            transition: background-color 0.2s;
        }
        .checkbox-item:hover { background-color: var(--secondary-color); }
        .checkbox-item input { width: 1.15rem; height: 1.15rem; margin-right: 0.75rem; accent-color: var(--primary-color); }
        
        .group-controls {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        .group-controls > div { display: flex; align-items: center; gap: 0.5rem; }
        input[type="number"] {
            width: 5rem;
            padding: 0.5rem;
            text-align: center;
            background-color: var(--input-bg);
            color: var(--body-color);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
        }

        /* Resultat */
        #results-container {
            margin-top: 2rem;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }
        .group-card { background-color: var(--input-bg); border: 1px solid var(--border-color); border-radius: 0.5rem; padding: 1rem; }
        .group-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; }
        .group-card h3 { font-size: 1.125rem; font-weight: 600; }
        .copy-btn { background-color: var(--secondary-color); color: var(--body-color); font-size: 0.75rem; padding: 0.25rem 0.5rem; }
        .copy-btn.copied { background-color: var(--green-color) !important; color: white !important; }
        .group-card ul { list-style: none; }
        .group-card li { padding: 0.25rem 0; }
        
        /* Klasseliste-spesifikt */
        .controls-container { display: flex; flex-direction: column; gap: 1.5rem; }
        @media (min-width: 768px) { .controls-container { flex-direction: row; } }
        .control-group { flex: 1; }

        #column-selection { display: flex; flex-direction: column; gap: 0.5rem; }
        .draggable-item { cursor: grab; display: flex; align-items: center; padding: 0.5rem; border-radius: 0.25rem; background-color: var(--input-bg); border: 1px solid var(--border-color); }
        .draggable-item.dragging { opacity: 0.5; }
        .draggable-item .checkbox-item { flex-grow: 1; }
        
        #sort-options { display: flex; flex-direction: column; gap: 0.5rem; }
        
        #classlist-output {
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem;
            white-space: pre-wrap; /* Endra for betre linjeskift */
            font-family: var(--font-sans); /* Endra fr친 monospace */
            overflow-x: auto;
            min-height: 100px;
            line-height: 1.5;
        }
        #copy-list-button { margin-top: 1rem; width: 100%; }

        /* Feilmelding */
        #error-message {
            margin-top: 1rem;
            padding: 0.75rem;
            background-color: rgba(192, 57, 43, 0.2);
            color: var(--red-color);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            text-align: center;
        }

        /* Footer */
        footer { margin-top: 2rem; font-family: var(--font-mono); color: #95a5a6; font-size: 0.875rem; text-align: center; }
        footer a { color: #bdc3c7; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; transition: color 0.2s; }
        footer a:hover { color: var(--primary-color); }
        footer svg { width: 1.2rem; height: 1.2rem; fill: currentColor; }

        /* Hjelpeklassar */
        .hidden { display: none !important; }
        @media (min-width: 640px) { #generate-groups-button { width: auto; } #copy-list-button { width: auto; } }
    </style>
</head>
<body>

    <div class="main-container">
        <button id="restart-button" aria-label="Start p친 nytt">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.3"/></svg>
        </button>
        <header>
            <h1>Verkt칮y for klasselister</h1>
            <p>Laga for klasselister fr친 <strong>Visma InSchool</strong>.</p>
        </header>

        <div id="guide-container" class="guide-box">
            <h2>Slik gjer du:</h2>
            <ol>
                <li>Skriv ut elevliste fr친 Visma InSchool (elevliste med bilete, inkluder namneliste).</li>
                <li>Kopier <strong>heile</strong> tabellen med namnelista (nummer, klasse, elevnamn, fagl칝rarnamn).</li>
                <li>Lim inn lista i tekstfeltet under og vel ein av funksjonane.</li>
            </ol>
        </div>

        <main>
            <div id="step1-container">
                <div style="margin-bottom: 1rem;">
                    <label for="student-list">Elevliste</label>
                    <textarea id="student-list" rows="10" placeholder="Lim inn heile klasselista fr친 Visma InSchool her...">01 1STA Per Hansen Peder 칀s
02 1STA Kari Johansen Peder 칀s
03 1STA Bj칮rn Olsen Peder 칀s
04 1STA Ingrid Larsen Peder 칀s
05 1STA Ole Andersen Peder 칀s
06 1STA Anne Nilsen Peder 칀s
07 1STA Jan Pedersen Peder 칀s
08 1STA Eva Kristiansen Peder 칀s
09 1STA Lars Jensen Peder 칀s
10 1STA Liv Karlsen Peder 칀s</textarea>
                </div>
                <div class="button-group">
                    <button id="classlist-init-button" class="btn-secondary">Lag klasseliste</button>
                    <button id="groups-init-button" class="btn-primary">Lag tilfeldige grupper</button>
                </div>
            </div>

            <div id="groups-setup-container" class="step2-section hidden">
                <h2>Vel elevar som skal vere med i gruppeinndelinga</h2>
                <div id="student-selection-list"></div>
                <div class="group-controls">
                    <div>
                        <label for="group-count">Tal p친 grupper:</label>
                        <input type="number" id="group-count" value="2" min="1">
                    </div>
                    <button id="generate-groups-button">Lag grupper</button>
                </div>
            </div>

            <div id="classlist-setup-container" class="step2-section hidden">
                <div class="controls-container">
                    <div class="control-group">
                        <h2>Sortering</h2>
                        <div id="sort-options"></div>
                    </div>
                    <div class="control-group">
                        <h2>Kolonnerekkef칮lgje (dra for 친 endre)</h2>
                        <div id="column-selection"></div>
                    </div>
                </div>
                <h2 style="margin-top: 1.5rem;">Resultat</h2>
                <pre id="classlist-output"></pre>
                <button id="copy-list-button" class="btn-primary">Kopier liste</button>
            </div>
            
            <div id="error-message" class="hidden"></div>
            <div id="results-container"></div>
        </main>
    </div>

    <footer>
        <a href="https://github.com/lektorodd/gruppegenerator" target="_blank" rel="noopener noreferrer">
            <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
            lektorodd
        </a>
    </footer>

    <script>
        let studentData = [];
        let columnOrder = ['fornamn', 'etternamn', 'klasse'];
        const columnDetails = { fornamn: 'Fornamn', etternamn: 'Etternamn', klasse: 'Klasse' };

        const studentListInput = document.getElementById('student-list');
        const restartButton = document.getElementById('restart-button');
        const guideContainer = document.getElementById('guide-container');
        const step1Container = document.getElementById('step1-container');
        const classlistInitButton = document.getElementById('classlist-init-button');
        const groupsInitButton = document.getElementById('groups-init-button');
        const groupsSetupContainer = document.getElementById('groups-setup-container');
        const studentSelectionList = document.getElementById('student-selection-list');
        const groupCountInput = document.getElementById('group-count');
        const generateGroupsButton = document.getElementById('generate-groups-button');
        const classlistSetupContainer = document.getElementById('classlist-setup-container');
        const sortOptionsContainer = document.getElementById('sort-options');
        const columnSelectionContainer = document.getElementById('column-selection');
        const classlistOutput = document.getElementById('classlist-output');
        const copyListButton = document.getElementById('copy-list-button');
        const resultsContainer = document.getElementById('results-container');
        const errorMessage = document.getElementById('error-message');

        restartButton.addEventListener('click', clearAll);
        classlistInitButton.addEventListener('click', initClasslistGenerator);
        groupsInitButton.addEventListener('click', initGroupsGenerator);
        generateGroupsButton.addEventListener('click', generateGroups);
        copyListButton.addEventListener('click', copyClasslist);

        function clearAll() {
            studentData = [];
            columnOrder = ['fornamn', 'etternamn', 'klasse'];
            studentListInput.value = '';
            [studentSelectionList, resultsContainer, classlistOutput, columnSelectionContainer, sortOptionsContainer].forEach(el => el.innerHTML = '');
            [errorMessage, groupsSetupContainer, classlistSetupContainer].forEach(el => el.classList.add('hidden'));
            step1Container.classList.remove('hidden');
            guideContainer.classList.remove('hidden');
            studentListInput.focus();
        }

        function initClasslistGenerator() {
            if (!parseAndStoreStudentData()) return;
            step1Container.classList.add('hidden');
            guideContainer.classList.add('hidden');
            classlistSetupContainer.classList.remove('hidden');
            setupSorting();
            setupColumnReordering();
            renderClasslist();
        }

        function initGroupsGenerator() {
            if (!parseAndStoreStudentData()) return;
            step1Container.classList.add('hidden');
            guideContainer.classList.add('hidden');
            groupsSetupContainer.classList.remove('hidden');
            studentSelectionList.innerHTML = '';
            studentData.forEach((student, index) => {
                createCheckbox(studentSelectionList, `student-${index}`, student.formattedName, true);
            });
        }

        function setupSorting() {
            sortOptionsContainer.innerHTML = '';
            const sortKeys = { original: 'Original', formattedName: 'Fornamn', lastName: 'Etternamn', className: 'Klasse' };
            Object.entries(sortKeys).forEach(([key, value], index) => {
                const item = createCheckbox(sortOptionsContainer, `sort-${key}`, value, index === 0, 'radio');
                const radio = item.querySelector('input');
                radio.name = 'sort-option';
                radio.addEventListener('change', () => {
                    sortStudentData(key);
                    renderClasslist();
                });
            });
        }

        function sortStudentData(key) {
            if (key === 'original') {
                studentData.sort((a, b) => a.originalIndex - b.originalIndex);
            } else {
                studentData.sort((a, b) => a[key].localeCompare(b[key], 'nn'));
            }
        }
        
        function setupColumnReordering() {
            columnSelectionContainer.innerHTML = '';
            columnOrder.forEach(key => {
                const item = document.createElement('div');
                item.className = 'draggable-item';
                item.draggable = true;
                item.dataset.key = key;
                
                const checkbox = createCheckbox(item, `col-${key}`, columnDetails[key], true);
                checkbox.querySelector('input').addEventListener('change', renderClasslist);
                
                columnSelectionContainer.appendChild(item);
            });
            addDragDropListeners();
        }

        function addDragDropListeners() {
            const draggables = columnSelectionContainer.querySelectorAll('.draggable-item');
            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', () => draggable.classList.add('dragging'));
                draggable.addEventListener('dragend', () => draggable.classList.remove('dragging'));
            });
            columnSelectionContainer.addEventListener('dragover', e => {
                e.preventDefault();
                const afterElement = getDragAfterElement(columnSelectionContainer, e.clientY);
                const dragging = document.querySelector('.dragging');
                if (afterElement == null) {
                    columnSelectionContainer.appendChild(dragging);
                } else {
                    columnSelectionContainer.insertBefore(dragging, afterElement);
                }
            });
            columnSelectionContainer.addEventListener('drop', () => {
                const newOrder = [...columnSelectionContainer.querySelectorAll('.draggable-item')].map(item => item.dataset.key);
                columnOrder = newOrder;
                renderClasslist();
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.draggable-item:not(.dragging)')];
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function renderClasslist() {
            const columns = {};
            columnOrder.forEach(key => {
                const checkbox = document.getElementById(`col-${key}`);
                columns[key] = checkbox ? checkbox.checked : true;
            });

            const listContent = studentData.map(student => {
                let line = [];
                columnOrder.forEach(key => {
                    if (columns[key]) {
                        let value = '';
                        if (key === 'fornamn') {
                            value = student.formattedName;
                        } else if (key === 'etternamn') {
                            value = student.lastName;
                        } else if (key === 'klasse') {
                            value = student.className;
                        }
                        line.push(value || '');
                    }
                });
                return line.join(' ');
            }).join('\n');
            classlistOutput.textContent = listContent;
        }

        function copyClasslist() {
            copyToClipboard(classlistOutput.textContent, copyListButton, "Kopier liste");
        }

        function generateGroups() {
            resultsContainer.innerHTML = '';
            const selectedCheckboxes = studentSelectionList.querySelectorAll('input[type="checkbox"]:checked');
            const selectedStudents = Array.from(selectedCheckboxes).map(cb => cb.dataset.name);
            const numGroups = parseInt(groupCountInput.value, 10);
            if (selectedStudents.length === 0) { showError("Du m친 velje minst 칠in elev."); return; }
            if (isNaN(numGroups) || numGroups < 1) { showError("Talet p친 grupper m친 vere eit positivt tal."); return; }
            if (numGroups > selectedStudents.length) { showError("Du kan ikkje ha fleire grupper enn valde elevar."); return; }
            const shuffledStudents = shuffleArray(selectedStudents);
            const groups = createGroups(shuffledStudents, numGroups);
            displayGroups(groups);
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
        }

        function parseAndStoreStudentData() {
            errorMessage.classList.add('hidden');
            const rawText = studentListInput.value.trim();
            if (rawText === '') { showError("Elevlista kan ikkje vere tom."); return false; }
            const lines = rawText.split('\n').filter(line => line.trim() !== '');
            try {
                studentData = parseStudentList(lines);
                if (studentData.length === 0) { showError("Fann ingen gyldige elevnamn i lista. Sjekk formatet."); return false; }
                return true;
            } catch (error) {
                showError(error.message);
                return false;
            }
        }

        function parseStudentList(lines) {
            if (lines.length === 0) return [];
            const words1 = lines[0].trim().split(/\s+/);
            const words2 = lines.length > 1 ? lines[1].trim().split(/\s+/) : words1;
            let teacherNameWords = [];
            let i = 1;
            while (words1.length - i >= 0 && words2.length - i >= 0 && words1[words1.length - i] === words2[words2.length - i]) {
                teacherNameWords.unshift(words1[words1.length - i]);
                i++;
            }
            if (teacherNameWords.length === 0 && lines.length > 1) { throw new Error("Kunne ikkje identifisere eit felles l칝rarnamn. Sjekk formatet."); }
            const teacherName = teacherNameWords.join(' ');
            const students = lines.map((line, index) => {
                const studentPart = line.trim().substring(0, line.trim().lastIndexOf(teacherName)).trim();
                const parts = studentPart.split(/\s+/);
                if (parts.length < 3) return null;
                return { originalIndex: index, className: parts[1], firstName: parts[2], lastName: parts.slice(3).join(' ') };
            }).filter(Boolean);
            const firstNameCounts = students.reduce((acc, student) => {
                acc[student.firstName] = (acc[student.firstName] || 0) + 1;
                return acc;
            }, {});
            return students.map(student => {
                let formattedName = student.firstName;
                if (firstNameCounts[student.firstName] > 1 && student.lastName) {
                    const initials = student.lastName.split(/\s+/).map(part => part.charAt(0).toUpperCase() + '.').join(' ');
                    formattedName = `${student.firstName} ${initials}`;
                }
                return { ...student, formattedName };
            });
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function createGroups(students, numGroups) {
            const groups = Array.from({ length: numGroups }, () => []);
            students.forEach((student, index) => {
                groups[index % numGroups].push(student);
            });
            return groups;
        }

        function displayGroups(groups) {
            resultsContainer.innerHTML = '';
            groups.forEach((group, index) => {
                const groupCard = document.createElement('div');
                groupCard.className = 'group-card';
                const header = document.createElement('div');
                header.className = 'group-card-header';
                const title = document.createElement('h3');
                title.textContent = `Gruppe ${index + 1}`;
                const copyButton = document.createElement('button');
                copyButton.className = 'copy-btn';
                copyButton.textContent = 'Kopier';
                copyButton.onclick = () => copyToClipboard(`Gruppe ${index + 1}:\n` + group.join('\n'), copyButton, "Kopier");
                header.appendChild(title);
                header.appendChild(copyButton);
                const list = document.createElement('ul');
                group.forEach(student => {
                    const listItem = document.createElement('li');
                    listItem.textContent = student;
                    list.appendChild(listItem);
                });
                groupCard.appendChild(header);
                groupCard.appendChild(list);
                resultsContainer.appendChild(groupCard);
            });
        }
        
        function createCheckbox(container, id, labelText, isChecked, type = 'checkbox') {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'checkbox-item';
            const checkbox = document.createElement('input');
            checkbox.type = type;
            checkbox.id = id;
            checkbox.checked = isChecked;
            checkbox.dataset.name = labelText;
            const label = document.createElement('label');
            label.htmlFor = id;
            label.textContent = labelText;
            label.className = 'cursor-pointer select-none';
            itemDiv.appendChild(checkbox);
            itemDiv.appendChild(label);
            container.appendChild(itemDiv);
            return itemDiv;
        }
        
        function copyToClipboard(text, button, originalText) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.opacity = "0";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                button.textContent = 'Kopiert!';
                button.classList.add('copied');
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            } catch (err) {
                console.error('Kunne ikkje kopiere tekst: ', err);
                showError("Kopiering til utklippstavla mislykkast.");
            }
            document.body.removeChild(textArea);
        }
    </script>
</body>
</html>
